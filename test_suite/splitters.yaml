- name: Can integrate a splitter
  before: _   >s   _
  after: ">   >s   >"

- name: Can integrate multiple splitters
  before: _   >s   >s
  after: ">   >s   >s   >"

- name: Other direction splitter is obstacle
  before: _   <s   _   ^s   _   _   vs   _
  after: ">i  <s   _   ^s   >o  >i  vs   >o  >"

- name: Splitter with blocked entrance is not integrated
  before: _   ^   >s
  after: ">i  ^   >s  >o"

- name: Splitter with blocked entrance makes following belt segment unintegrated
  before: _   ^   >s  >
  after: ">i  ^   >s  >   >o"

- name: Backwards belt connected to splitter results in obstacle
  before: _   <   <s   _
  after: ">i  <   <s   >o"

- name: Cannot use splitter as underground output location
  before: _   X   X   X   >s   >   _
  after: ">   X   X   X   >s   >   *>  "
  expected_errors: [too_far_to_connect]

- name: Can upgrade a splitter
  before: _   2>s  _
  after: ">   >s   >"

- name: Splitter with belt curved belt after it is not integrated
  before: _   >s   >   2>   ^
  after: ">i  >s   >   2>   ^   >o"

- name: Splitter with belt curved belt after is integrated if too long to check
  before: _   2>s  2>  2>  2>  2>  >   >   ^
  after: ">   >s   >   >   >   >   >   >   ^"

- name: Double splitter with belt curved after it is not integrated
  before: _   >s   >s   >   ^
  after: ">i  >s   >s   >   ^   >o"

- name: Splitter with belt curved belt after, but also curved belt before, is integrated
  before: _   >   >s   >   2>   ^
  after: ">   >   >s   >    >   ^  *>"
  expected_errors: [entity_in_the_way]

- name: Splitter with ug belt after it is still integrated if can belt weave
  before: _   >s   >i   >o   ^
  after: "2>i >s   >i   >o   ^   2>o"

- name: Underground belt obstacle
  before: "_ ^i vi ^o vo"
  after: ">i ^i vi ^o vo >o"

- name: Unpaired underground is replaced
  before: "_ >o >i 2<i 2<o"
  after: "> > > > > > >"

- name: Unpaired underground after obstacle is replaced
  before: "_ _ X X >o"
  after: "> >i X X >o >"

- name: Passing through existing underground
  before: "_ _ >i X ^ > X >o _"
  after: "> > >i X ^ > X >o >"

- name: Flipping existing underground
  before: "_ _ <o <i > >"
  after: "> > >i >o > >"

- name: Obstacle after underground is error
  before: "_ >i >o X X"
  after: "> >i >o *X X"
  expected_errors: [entity_in_the_way]

- name: Error recovery
  before: "_ >i >o X X X X X X X X X X"
  after: "> >i >o *X X X X X X X X X X >"
  expected_errors: [entity_in_the_way]

- name: Curved belt after underground
  before: "_ _ >i >o ^ >"
  after: "> > >i >o ^ *>"
  expected_errors: [entity_in_the_way]

- name: Can flip belt after underground
  before: "_ _ >i >o < >"
  after: "> > >i >o > >"

- name: Can integrate belt after underground
  before: "_ _ >i >o >o >"
  after: "> > >i >o > >"

- name: running into the back of a paired underground is an obstacle
  before: "2>i *_ _ 2>o >"
  after: "2>i > >i 2>o > >o >"

- name: Upgrading existing underground
  before: "_ _ 2<o 2<i > >"
  after: "> > >i >o > >"

- name: Cannot upgrade due to too making too short
  before: "_ 2<o _ _ _ _ _ 2<i _"
  after: "> *2>i _ _ _ _ _ 2>o >"
  expected_errors: [cannot_upgrade_underground]

- name: Cannot upgrade due to intercepting underground 1
  before: "_ 2<o _ >o _ _ 2<i _"
  after: "> *2>i _ >o _ _ 2>o >"
  expected_errors: [cannot_upgrade_underground]

- name: Cannot upgrade due to intercepting underground 2
  before: "_ 2<o _ >i _ _ 2<i _"
  after: "> *2>i _ >i _ _ 2>o >"
  expected_errors: [cannot_upgrade_underground]

- name: Cannot upgrade due to intercepting underground 3
  before: "_ 2<o _ <o _ _ 2<i _"
  after: "> *2>i _ <o _ _ 2>o >"
  expected_errors: [cannot_upgrade_underground]

- name: Cannot upgrade due to intercepting underground 4
  before: "_ 2<o _ <i _ _ 2<i _"
  after: "> *2>i _ <i _ _ 2>o >"
  expected_errors: [cannot_upgrade_underground]

- name: Still can upgrade if another tier
  before: "_ 2<o _ 3<i _ _ 2<i _"
  after: "> >i _ 3<i _ _ >o >"

- name: Still can upgrade if wrong direction
  before: "_ 2<o _ ^i _ _ 2<i _"
  after: "> >i _ ^i _ _ >o >"

- name: Can upgrade underground after curved belt failure
  before: "_ > ^ 2>i _ 2>o"
  after: "> > ^ *>i _ >o"
  expected_errors: [entity_in_the_way]

- name: Can upgrade underground after blocked output failure
  before: "_ >i >o X X X 2<o 2<i"
  after: "> >i >o *X X X >i >o >"
  expected_errors: [entity_in_the_way]

- name: Can have multiple errors
  before: "_ > ^ 2>i >o 2>o"
  after: "> > ^ **2>i >o 2>o"
  expected_errors: [entity_in_the_way, cannot_upgrade_underground]

- name: unenterable underground of different tier is obstacle
  before: "_ X 2>i _ _ 2>o"
  after: ">i X 2>i >o >i 2>o >o >"

- name: unenterable underground of same tier is impassable
  before: "_ X >i >o _"
  after: "> X *>i >o >"
  expected_errors:
    - entity_in_the_way

- name: backwards paired underground of different tier is obstacle
  before: "2<o *_ 2<i < <"
  after: "2<o >i 2<i < < >o"

- name: backwards paired underground of same tier is impassable, and doesn't override later belt
  before: "<o *_ <i < <"
  after: "<o > *<i < < >"
  expected_errors: [entity_in_the_way]
