- name: Can integrate a splitter
  before: _ >s _
  after: "> >s >"

- name: Can integrate multiple splitters
  before: _ >s >s
  after: "> >s >s >"

- name: Other direction splitter is obstacle
  before: _ <s _ ^s X _ _ vs X
  after: "2>i <s _ ^s X 2>o 2>i vs X 2>o 2>"

- name: Splitter with blocked entrance is not integrated
  before: _ X >s
  after: ">i X >s >o"

- name: Splitter with blocked entrance makes following belt segment unintegrated
  before: _ X >s >
  after: ">i X >s > >o"

- name: Backwards belt connected to splitter results in obstacle
  before: _ < <s _
  after: ">i < <s >o"

- name: Cannot use splitter as underground output location
  before: _ X X X >s > _
  after: "> X X X >s > *> "
  expected_errors: [too_far_to_connect]

- name: Can upgrade a splitter
  before: _ 2>s _
  after: "> >s >"

- name: Splitter with curved belt after it is not integrated
  before: |
    _  _ _ _  ^
    _ >s > 2> ^
  after: |
    _ _ _ _ ^
    >i >s > 2> ^ >o

- name: Splitter with curved belt after is integrated if too long to check
  before: |
    _  _  _  _  _  _  _ _ ^
    _ 2>s 2> 2> 2> 2> > > ^
  after: |
    _ _  _ _ _ _ _ _ ^
    > >s > > > > > > ^

- name: Double splitter with belt curved after it is not integrated
  before: |
    _ _  _  _ ^
    _ >s >s > ^
  after: |
    _ _  _  _ ^
    >i >s >s > ^ >o

- name: Splitter with belt curved belt after, but belt input is still integrated
  before: |
    _ _ _  _  _ ^
    _ > >s > 2> ^
  after: |
    _ _ _  _ _ ^
    > > >s > > ^ *>
  expected_errors: [belt_line_broken]

- name: Splitter with ug belt after it is undergrounded if we can belt weave
  before: |
    _  _  _  _ ^
    _ >s >i >o ^
  after: |
    _   _  _  _  ^
    2>i >s >i >o ^ 2>o

- name: Splitter with ug belt after it is not integrated if cannot belt weave
  before: |
    _  _  _  _ ^
    _ >s >i >o ^ X
  after: |
    _  _  _  _ ^
    > >s >i >o ^ X *>
  expected_errors: [belt_line_broken]

- name: Splitter after splitter
  before: |
    _  _ _ _ _ _  ^
    _ >s > > >s > ^
  after: |
    _ _  _ _ _   _ ^
    > >s > > >s  > ^ *>
  expected_errors: [belt_line_broken]

- name: splitter ending in loader is integrated
  before: |
    _ >s > >I
  after: |
    > >s > >I

- name: Splitter segment ending in unrelated belt 1
  before: |
    _ >s > ^ <
  after: |
    > >s >i ^ >o

- name: Splitter segment ending in unrelated belt 2
  before: |
    _ >s > ^i
  after: |
    > >s >i ^i >o

- name: Splitter segment ending in unrelated belt 3
  before: |
    _ >s > >i
  after: |
    > >s > >

- name: obstacle extension to over backwards segment
  before: |
    _ _ _ _  ^
    _ X _ >s ^
  after: |
    _  _ _ _  ^
    >i X _ >s ^ >o

- name: curved input behind splitter
  before: |
    _ <s ^ <
  after: |
    <o <s ^ < <i
  not_reversible: true

- name: breaking backwards splitter segment
  before: |
    _ < < < < <s
  after: |
    > > > > > <s *>
  expected_errors: [belt_line_broken]

- name: always enter splitter after error
  before: |
    _ > ^ 2>s > ^
  after: |
    > > ^ *>s > ^
  expected_errors: [belt_line_broken]
  not_reversible: true

- name: Entered splitter to obstacle
  before: "_ > >s X _"
  after: "> > >s *X >"
  expected_errors: [entity_in_the_way]

- name: Entered splitter to perpendicular belt
  before: |
    _ _  _ ^
    _ > >s ^ _
  after: |
    _ _  _ ^
    > > >s ^ *>
  expected_errors: [belt_line_broken]

- name: Blocked lonely splitter 1
  before: "_ _ >s X _"
  after: "> >i >s X >o"

- name: Blocked lonely splitter 2
  before: |
    _ _  _ v
    _ _ >s v _
  after: |
    _ _  _  v
    > >i >s v >o

- name: Not blocked lonely splitter 1
  before: |
    _ _ >s < _
  after: |
    > > >s > >

- name: Not blocked lonely splitter 2
  before: |
    _ _ >s <o <i
  after: |
    > > >s >i >o
